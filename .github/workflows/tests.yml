name: Testes Automatizados e Qualidade de Código

on:
  push:
    branches: [ main, principal ]
  pull_request:
    branches: [ main, principal ]

jobs:
  test:
    name: Executar Testes e Linting
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout do código
      - name: Checkout código
        uses: actions/checkout@v4
      
      # 2. Configurar Python
      - name: Configurar Python 3.9
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      
      # 3. Instalar dependências
      - name: Instalar dependências
        run: |
          python -m pip install --upgrade pip
          pip install flake8 pytest pytest-cov
          if [ -f "requirements.txt" ]; then
            pip install -r requirements.txt
          fi
      
      # 4. Verificar Qualidade do Código com Flake8
      - name: Validar Estilo de Código com Flake8
        run: |
          flake8 tests/ --max-line-length=100 --exclude=test_kanban.py
      
      # 5. Executar testes com cobertura
      - name: Executar Testes com Cobertura
        run: |
          export PYTHONPATH=$PYTHONPATH:$(pwd)/src:$(pwd)
          pytest -v --cov=src --cov-report=term-missing tests/
