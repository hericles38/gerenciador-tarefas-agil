name: Testes Automatizados

# Quando executar este workflow
on:
  push:
    branches: [ main, principal ]
  pull_request:
    branches: [ main, principal ]

# Permissões necessárias
permissions:
  contents: read

jobs:
  test:
    name: Executar Testes
    runs-on: ubuntu-latest
    
    steps:
    # 1. Checkout do código
    - name: Checkout código
      uses: actions/checkout@v3
    
    # 2. Configurar Python
    - name: Configurar Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    # 3. Instalar dependências
    - name: Instalar dependências
      run: |
        python -m pip install --upgrade pip
        pip install pytest pytest-cov
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
    
    # 4. Executar testes com cobertura
    - name: Executar testes
      run: |
        pytest -v --cov=src --cov-report=term-missing
    
    # 5. Verificar qualidade do código
    - name: Verificar sintaxe Python
      run: |
        python -m py_compile src/*.py || true
        find tests -name "*.py" -exec python -m py_compile {} \; || true
